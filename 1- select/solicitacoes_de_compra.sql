SELECT DISTINCT A.DATAINCLUSAO AS DATA_INCLUSAO_SOL_PAI,
EMP.NOME AS NOME_EMPRESA,
FIL.NOME AS NOME_FILIAL,

CASE WHEN A.STATUS = 1 THEN 'CADASTRADA' ELSE
   CASE WHEN A.STATUS = 2 THEN 'CONFIRMADA' ELSE
       CASE WHEN A.STATUS = 3 THEN 'EM ATENDIMENTO' ELSE
          CASE WHEN A.STATUS = 4 THEN 'ENCERRADA' ELSE
             CASE WHEN A.STATUS = 5 THEN 'RECUSADA' ELSE
                CASE WHEN A.STATUS = 6 THEN 'CANCELADA' ELSE 'ATENDIMENTO DIVERGENTE'
                END
             END
          END
       END
   END
END AS STATUS_SOL_PAI,

CASE WHEN SOL_ITENS.STATUS = 1 THEN 'CADASTRADA' ELSE
   CASE WHEN SOL_ITENS.STATUS = 2 THEN 'ATENDIMENTO DIVERGENTE' ELSE
       CASE WHEN SOL_ITENS.STATUS = 3 THEN 'EM ATENDIMENTO' ELSE
          CASE WHEN SOL_ITENS.STATUS = 4 THEN 'ENCERRADA' ELSE
             CASE WHEN SOL_ITENS.STATUS = 5 THEN 'CANCELADA'
             END
          END
       END
   END
END AS STATUS_SOL_FILHO,

CASE WHEN A.MODALIDADE = 'R' THEN 'REGULARIZAÇÃO' ELSE
    CASE WHEN A.MODALIDADE = 'C' THEN 'CATALOGO' ELSE 'NORMAL' END
END AS MODALIDADE,
A.NUMERO AS NUM_SOL_PAI,
SOL_ITENS.NUMERO AS NUM_SOL_FILHO,
OCS.NUMERO AS ORDEM_DE_COMPRA,
UPPER(SOL.APELIDO) AS NOME_DO_SOLICITANTE,
UPPER(SOL.EMAIL) AS EMAIL_DO_SOLICITANTE,

CASE WHEN UPPER(SOL_APROVA.APELIDO) IS NOT NULL THEN UPPER(SOL_APROVA.APELIDO) ELSE
UPPER(APR.APELIDO) END AS NOME_DO_APROVADOR,
CASE WHEN UPPER(SOL_APROVA.EMAIL) IS NOT NULL THEN UPPER(SOL_APROVA.EMAIL) ELSE
UPPER(APR.EMAIL) END AS EMAIL_DO_APROVADOR,

REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(A.MOTIVOSTATUS ,char(13),''),char(9),''),char(10),''),'/N','/ N'),'/R','/ R') AS MOTIVO_STATUS,

SOL_ITENS.QUANTIDADE AS QUANTIDADE_SOLICITADA,
SOL_ITENS.VALORESTIMADO AS VALOR_DO_ITEM,
RA.CODIGO AS CENTRO_DE_CUSTO,
CASE WHEN SOL_ITENS.PROJETO IS NULL THEN 'OPEX' ELSE
'CAPEX' END AS PROJETO,
CONCAT(FIN.ESTRUTURA,' - ',FIN.CODIGO) AS FINALIDADE_ESTRUTURA,
FIN.DESCRICAO AS FINALIDADE_DESCRICAO,


REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(A.OBSERVACOES ,char(13),''),char(9),''),char(10),''),'/N','/ N'),'/R','/ R') AS TEXTO_OBSERVACOES,
REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(AC.NOME ,char(13),''),char(9),''),char(10),''),'/N','/ N'),'/R','/ R') AS NOME_ITEM,
EA.NOME AS UNIDADE_DE_MEDIDA

FROM CP_SOLICITACOES A
LEFT JOIN EMPRESAS EMP ON EMP.HANDLE = A.EMPRESA
LEFT JOIN FILIAIS FIL ON FIL.HANDLE = A.FILIAL
LEFT JOIN Z_GRUPOUSUARIOS SOL ON SOL.HANDLE = A.SOLICITANTE
LEFT JOIN Z_GRUPOUSUARIOS APR ON APR.HANDLE = A.USUARIOALTERACAO
LEFT JOIN CP_SOLICITACAOITENS SOL_ITENS ON SOL_ITENS.SOLICITACAO = A.HANDLE
LEFT JOIN PD_PRODUTOS AC ON AC.HANDLE = SOL_ITENS.PRODUTO
INNER JOIN CM_UNIDADESMEDIDA EA ON  EA.HANDLE = AC.UNIDADEMEDIDACOMPRAS
LEFT JOIN CP_FINALIDADES FIN ON FIN.HANDLE = SOL_ITENS.FINALIDADE
LEFT JOIN CT_CC RA ON RA.HANDLE = SOL_ITENS.CENTROCUSTO
LEFT JOIN (SELECT * FROM CP_SOLICITACAOHISTORICO WHERE DESCRICAO = 'Aguardando aprovação') SOL_HIST ON SOL_HIST.SOLICITACAO = A.HANDLE
LEFT JOIN Z_GRUPOUSUARIOS SOL_APROVA ON SOL_APROVA.HANDLE=SOL_HIST.USUARIO
LEFT JOIN CP_ORDENSCOMPRA OCS ON OCS.NUMERODOCUMENTOORIGEM = A.NUMERO
WHERE A.NUMERO IN ("357623","357937","356043","354382","354910","354868","354976","354869","356197","356191","358074","356154","356175","354701","350422","350423","350419","357788","353702","354569","355724","355583","356075","357686","355236","344368","344632","354692","344659","344501","344482","349595","355125","357820","357226","350225","354287","354296","353517","349797","354589","357916","354591","355805","344786","355017","354648","339200","353649","356225","354771","354791","347876","347902","354558","340431","353345","354877","338743","354235","349924","357255","354655","357104","357175","357903","354407","355063","355071","354294","344761","357552","357513","357914","357632","343545","357638","347329","339727","339607","344858","354748","351659","357169","353476","353577","354797","353487","341049","345057","355544","353338","358219","339465","339360","352434","349857","349800","349734","352457","342502","342444","352089","352131","346611","355851","355053","355062","349265","349294","349313","349325","349386","349529","355870","346162","366213","357537","349864","349878","349872","339673","351647","346610","353595","341552","357866","357628","357728","348008","353688","357521","349002","348996","349024","349014","355962","349082","349035","349092","349102","349110","349125","341646","341630","354959","349139","349158","346471","351792","351817","341518","341853","353245","351875","341778","346059","346053","345980","347154","350271","352680","350284","357952","352688","348847","348875","348829","348817","348909","353564","354628","341884","354394","354384","353012","341772","341740","348626","348638","348651","341815","348663","353400","341845","348691","350706","350726","350793","350836","354404","353673","353691","353242","341860","357584","357525","357512","357530","354747","339606","341887","351184","348017","353370","357495","349702","350272","341900","354618","349751","349776","353389","352051","348931","353314","349012","350117","349591","353441","354252","350455","351504","351511","354952","354929","354943","354948","350937","351536","357883","353420","342107","342074","353464","349796","353061","353645","353573","352738","358080","353459","353516","353519","353502","353494","354086","354075","346543","342170","348013","357421","347518","347529","353566","342445","351895","353293","353286","353283","353279","342846","342855","342792","345833","339758","351986","351542","356290","353265","342577","355117","348232","348212","348645","347984","348031","348024","348052","348012","348102","352074","352058","353258","354605","342775","353001","352970","353023","338649","347370","347378","347334","347350","350104","354436","354445","347542","347565","352961","344873","347810","347882","347935","345723","339989","339974","339931","357803","352944","352930","352922","348228","357565","352527","343014","344938","358196","351763","353278","352822","352763","353406","353395","353391","353381","353378","353369","352450","343113","352780","351309","349845","343067","343060","352526","358141","352490","348426","339838","353601","344047","352157","352141","352127","352109","352055","352075","352820","352835","350869","357393","352043","352004","352016","352025","341991","341928","353740","343316","351990","351983","352985","351948","353549","352992","353010","346556","346725","354592","346708","346744","352951","352869","343044","357365","351196","345274","342110","353138","352816","353705","341880","357878","357348","357823","357853","358128","342436","342687","357633","342498","357172","346833","346896","344449","355359","343114","357337","347402","343394","358208","342997","357708","349107","357721","345732","377785","354060","353240","353466","354936","354912","353543","353515","353512","353496","352474","352422","348022","348157","357152","357746","349028","342886","353325","350867","357368","357364","357948","358104","357789","357279","357275","357972","351793","351769","350922","350938","355854","354159","354146","354225","353970","353974","355600","353963","353947","354111","351530","351554","353909","351163","351088","354236","354191","353043","354333","349223","354501","354285","354046","354067","354087","355866","355857","354251","353336","354300","350578","350671","353999","353978","353035","353051","353893","353916","353925","353938","353937","353985","353930","353943","353906","353917","353874","357610","353915","353461","353875","353883","353892","353901","353913","353929","353951","353941","354227","352362","352226","355614","355636","355672","355699","355693","355641","355677","355618","355639","355645","355654","355659","355664","355646","355722","355631","355661","355678","355708","355692","355711","355651","355657","355662","355593","355606","355617","355629","355642","355587","355607","355647","355658","355669","355675","355701","355707","355676","355687","355695","355567","355561","355581","355628","355635","355649","355655","355679","355697","355706","355691","355546","354276","355547","355576","355562","355626","355648","355550","355935","355627","355611","355608","355586","355571")
