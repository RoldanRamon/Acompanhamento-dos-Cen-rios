SELECT DISTINCT A.DATAINCLUSAO AS DATA_INCLUSAO_SOL_PAI,
EMP.NOME AS NOME_EMPRESA,
FIL.NOME AS NOME_FILIAL,

CASE WHEN A.STATUS = 1 THEN 'CADASTRADA' ELSE
   CASE WHEN A.STATUS = 2 THEN 'CONFIRMADA' ELSE
       CASE WHEN A.STATUS = 3 THEN 'EM ATENDIMENTO' ELSE
          CASE WHEN A.STATUS = 4 THEN 'ENCERRADA' ELSE
             CASE WHEN A.STATUS = 5 THEN 'RECUSADA' ELSE
                CASE WHEN A.STATUS = 6 THEN 'CANCELADA' ELSE 'ATENDIMENTO DIVERGENTE'
                END
             END
          END
       END
   END
END AS STATUS_SOL_PAI,

CASE WHEN SOL_ITENS.STATUS = 1 THEN 'CADASTRADA' ELSE
   CASE WHEN SOL_ITENS.STATUS = 2 THEN 'ATENDIMENTO DIVERGENTE' ELSE
       CASE WHEN SOL_ITENS.STATUS = 3 THEN 'EM ATENDIMENTO' ELSE
          CASE WHEN SOL_ITENS.STATUS = 4 THEN 'ENCERRADA' ELSE
             CASE WHEN SOL_ITENS.STATUS = 5 THEN 'CANCELADA'
             END
          END
       END
   END
END AS STATUS_SOL_FILHO,

CASE WHEN A.MODALIDADE = 'R' THEN 'REGULARIZAÇÃO' ELSE
    CASE WHEN A.MODALIDADE = 'C' THEN 'CATALOGO' ELSE 'NORMAL' END
END AS MODALIDADE,
A.NUMERO AS NUM_SOL_PAI,
SOL_ITENS.NUMERO AS NUM_SOL_FILHO,
OCS.NUMERO AS ORDEM_DE_COMPRA,
UPPER(SOL.APELIDO) AS NOME_DO_SOLICITANTE,
UPPER(SOL.EMAIL) AS EMAIL_DO_SOLICITANTE,

CASE WHEN UPPER(SOL_APROVA.APELIDO) IS NOT NULL THEN UPPER(SOL_APROVA.APELIDO) ELSE
UPPER(APR.APELIDO) END AS NOME_DO_APROVADOR,
CASE WHEN UPPER(SOL_APROVA.EMAIL) IS NOT NULL THEN UPPER(SOL_APROVA.EMAIL) ELSE
UPPER(APR.EMAIL) END AS EMAIL_DO_APROVADOR,

REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(A.MOTIVOSTATUS ,char(13),''),char(9),''),char(10),''),'/N','/ N'),'/R','/ R') AS MOTIVO_STATUS,

SOL_ITENS.QUANTIDADE AS QUANTIDADE_SOLICITADA,
SOL_ITENS.VALORESTIMADO AS VALOR_DO_ITEM,
RA.CODIGO AS CENTRO_DE_CUSTO,
CASE WHEN SOL_ITENS.PROJETO IS NULL THEN 'OPEX' ELSE
'CAPEX' END AS PROJETO,
CONCAT(FIN.ESTRUTURA,' - ',FIN.CODIGO) AS FINALIDADE_ESTRUTURA,
FIN.DESCRICAO AS FINALIDADE_DESCRICAO,


REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(A.OBSERVACOES ,char(13),''),char(9),''),char(10),''),'/N','/ N'),'/R','/ R') AS TEXTO_OBSERVACOES,
REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(AC.NOME ,char(13),''),char(9),''),char(10),''),'/N','/ N'),'/R','/ R') AS NOME_ITEM,
EA.NOME AS UNIDADE_DE_MEDIDA

FROM CP_SOLICITACOES A
LEFT JOIN EMPRESAS EMP ON EMP.HANDLE = A.EMPRESA
LEFT JOIN FILIAIS FIL ON FIL.HANDLE = A.FILIAL
LEFT JOIN Z_GRUPOUSUARIOS SOL ON SOL.HANDLE = A.SOLICITANTE
LEFT JOIN Z_GRUPOUSUARIOS APR ON APR.HANDLE = A.USUARIOALTERACAO
LEFT JOIN CP_SOLICITACAOITENS SOL_ITENS ON SOL_ITENS.SOLICITACAO = A.HANDLE
LEFT JOIN PD_PRODUTOS AC ON AC.HANDLE = SOL_ITENS.PRODUTO
INNER JOIN CM_UNIDADESMEDIDA EA ON  EA.HANDLE = AC.UNIDADEMEDIDACOMPRAS
LEFT JOIN CP_FINALIDADES FIN ON FIN.HANDLE = SOL_ITENS.FINALIDADE
LEFT JOIN CT_CC RA ON RA.HANDLE = SOL_ITENS.CENTROCUSTO
LEFT JOIN (SELECT * FROM CP_SOLICITACAOHISTORICO WHERE DESCRICAO = 'Aguardando aprovação') SOL_HIST ON SOL_HIST.SOLICITACAO = A.HANDLE
LEFT JOIN Z_GRUPOUSUARIOS SOL_APROVA ON SOL_APROVA.HANDLE=SOL_HIST.USUARIO
LEFT JOIN CP_ORDENSCOMPRA OCS ON OCS.NUMERODOCUMENTOORIGEM = A.NUMERO
WHERE A.NUMERO IN ("354791","358557","358611","354771","358439","338743","358422","358499","358406","358565","358567","358569","358570","347154","349125","358572","358507","358484","358584","353258","357789","355359","351990","353740","355851","358141","352992","346471","358080","357633","345057","350271","350284","353705","358493","342687","354404","357169","348426","352738","349864","358587","343014","355053","346610","350836","352157","341880","345274","357746","354060","358301","339673","349591","357552","357803","358249","353001","347882","353595","343545","342107","342577","342170","357537","346611","342436","355062","349002","347529","348817","342502","344449","339758","357495","353406","352051","351948","353240","358596","357628","357728","357172","351647","357823","358196","357152","352970","358604","358600","357368","358595","357853","352835","358582","350455","350937","349796","343067","357952","357632","350867","353023","358601","358287","344873","343060","342110","357866","352055","358599","341518","358286","358607","352131","344938","353325","358298","343316","357513","342846","358295","352075","350706","354747","345833","358586","358279","346543","341853","342855","354936","354912","348022","353543","353515","353512","353496","352474","352422","353487","346162","348008","338649","350726","351659","358128","358576","349857","349800","349734","353577","354797","354618","357565","342792","352820","358104","357364","352869","357279","357275","348052","351196","353476","357914","357365","352527","366213","355569","358574","349223","358593","358583","353043","355608","355571")
